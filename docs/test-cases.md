# テストケース仕様書

## 概要

このドキュメントは、アウトラインエディタの設計書（design.md）を基に作成したテストケースを記載します。テストはAPI、フロントエンド、データベースの各層に対して実施します。

## テストケース一覧

### APIテスト

#### TC-API-001: 全ノード取得
- **テスト名**: 全ノード取得APIの正常動作確認
- **前提条件**: データベースにノードが存在する
- **テストステップ**:
  1. GET /api/nodes にリクエスト送信
- **期待結果**: ステータス200、success: true、dataにノード配列が返却される

#### TC-API-002: 特定ノード取得
- **テスト名**: 特定ノード取得APIの正常動作確認
- **前提条件**: 指定IDのノードが存在する
- **テストステップ**:
  1. GET /api/nodes/{id} にリクエスト送信
- **期待結果**: ステータス200、success: true、指定ノードのデータが返却される

#### TC-API-003: 存在しないノード取得
- **テスト名**: 存在しないノード取得時のエラーハンドリング
- **前提条件**: 存在しないノードIDを使用
- **テストステップ**:
  1. GET /api/nodes/99999 にリクエスト送信
- **期待結果**: ステータス404、success: false、エラーメッセージが返却される

#### TC-API-004: 子ノード取得
- **テスト名**: 子ノード取得APIの正常動作確認
- **前提条件**: 親ノードに子ノードが存在する
- **テストステップ**:
  1. GET /api/nodes/{parent_id}/children にリクエスト送信
- **期待結果**: ステータス200、success: true、子ノード配列が返却される

#### TC-API-005: ルートノード取得
- **テスト名**: ルートノード取得APIの正常動作確認
- **前提条件**: ルートノードが存在する
- **テストステップ**:
  1. GET /api/nodes/root/list にリクエスト送信
- **期待結果**: ステータス200、success: true、ルートノード配列が返却される

#### TC-API-006: ノード作成
- **テスト名**: ノード作成APIの正常動作確認
- **前提条件**: なし
- **テストステップ**:
  1. POST /api/nodes に以下のデータを送信
     ```json
     {
       "title": "テストノード",
       "content": "テスト内容",
       "author": "テストユーザー"
     }
     ```
- **期待結果**: ステータス201、success: true、作成されたノードデータが返却される

#### TC-API-007: ノード作成（必須フィールドなし）
- **テスト名**: ノード作成時のバリデーション
- **前提条件**: なし
- **テストステップ**:
  1. POST /api/nodes にtitleなしのデータを送信
- **期待結果**: ステータス400、success: false、エラーメッセージが返却される

#### TC-API-008: ノード更新
- **テスト名**: ノード更新APIの正常動作確認
- **前提条件**: 更新対象のノードが存在する
- **テストステップ**:
  1. PUT /api/nodes/{id} に以下のデータを送信
     ```json
     {
       "title": "更新タイトル",
       "content": "更新内容"
     }
     ```
- **期待結果**: ステータス200、success: true、更新されたノードデータが返却される

#### TC-API-009: ノード削除
- **テスト名**: ノード削除APIの正常動作確認
- **前提条件**: 削除対象のノードが存在する
- **テストステップ**:
  1. DELETE /api/nodes/{id} を送信
- **期待結果**: ステータス200、success: true、削除メッセージが返却される

#### TC-API-010: 親子関係追加
- **テスト名**: 親子関係追加APIの正常動作確認
- **前提条件**: 親ノードと子ノードが存在する
- **テストステップ**:
  1. POST /api/relations に以下のデータを送信
     ```json
     {
       "parent_node_id": 1,
       "child_node_id": 2
     }
     ```
- **期待結果**: ステータス201、success: true、リレーションが作成される

#### TC-API-011: 循環参照防止
- **テスト名**: 循環参照の防止確認
- **前提条件**: A→B→Cの関係が存在
- **テストステップ**:
  1. POST /api/relations でC→Aの関係を追加しようとする
- **期待結果**: ステータス400、success: false、循環参照エラーが返却される

#### TC-API-012: 検索機能
- **テスト名**: 検索APIの正常動作確認
- **前提条件**: 検索対象のノードが存在する
- **テストステップ**:
  1. GET /api/search?q=検索語 を送信
- **期待結果**: ステータス200、success: true、検索結果が返却される

### フロントエンドテスト

#### TC-UI-001: ツリー表示
- **テスト名**: ツリー構造の正しい表示確認
- **前提条件**: ノードデータが存在する
- **テストステップ**:
  1. ページを読み込み
  2. 左ペインのツリー構造を確認
- **期待結果**: 階層構造が正しく表示され、展開/折りたたみが可能

#### TC-UI-002: ノード選択
- **テスト名**: ノード選択時の動作確認
- **前提条件**: ノードが表示されている
- **テストステップ**:
  1. ツリーからノードをクリック
- **期待結果**: 右ペインにノード詳細が表示され、選択状態がハイライトされる

#### TC-UI-003: ノード作成
- **テスト名**: 新規ノード作成の動作確認
- **前提条件**: ツリーが表示されている
- **テストステップ**:
  1. 「ルートノード追加」ボタンをクリック
  2. タイトルと内容を入力
  3. 保存ボタンをクリック
- **期待結果**: 新規ノードがツリーに追加され、詳細が表示される

#### TC-UI-004: ノード編集
- **テスト名**: ノード編集の動作確認
- **前提条件**: ノードが選択されている
- **テストステップ**:
  1. 右ペインでタイトルや内容を編集
  2. 保存ボタンをクリック
- **期待結果**: ノードが更新され、変更がツリーに反映される

#### TC-UI-005: ノード削除
- **テスト名**: ノード削除の動作確認
- **前提条件**: 削除対象のノードが存在する
- **テストステップ**:
  1. ノードを選択
  2. 削除ボタンをクリック
  3. 確認ダイアログでOKをクリック
- **期待結果**: ノードが削除され、ツリーから消える

#### TC-UI-006: ドラッグ&ドロップ
- **テスト名**: ノードの並び替え確認
- **前提条件**: 複数のノードが存在する
- **テストステップ**:
  1. ノードをドラッグ
  2. 別の位置にドロップ
- **期待結果**: ノードの順序が変更され、保存される

#### TC-UI-007: 検索機能
- **テスト名**: 検索機能の動作確認
- **前提条件**: 検索対象のノードが存在する
- **テストステップ**:
  1. 検索バーにキーワードを入力
- **期待結果**: リアルタイムで検索結果が表示され、該当ノードがハイライトされる

#### TC-UI-009: キーボードナビゲーション（右キー展開）
- **テスト名**: 右キーによる子ノード展開確認
- **前提条件**: 子ノードを持つノードが選択されている
- **テストステップ**:
  1. ツリーで親ノードを選択
  2. 右キーを押す
- **期待結果**: 子ノードが表示され、ツリーが展開される

#### TC-UI-010: キーボードナビゲーション（左キー折りたたみ）
- **テスト名**: 左キーによる子ノード折りたたみ確認
- **前提条件**: 展開された親ノードが選択されている
- **テストステップ**:
  1. 展開された親ノードを選択
  2. 左キーを押す
- **期待結果**: 子ノードが非表示になり、ツリーが折りたたまれる

#### TC-UI-011: キーボードナビゲーション（下キー移動）
- **テスト名**: 下キーによる下ノードへの遷移確認
- **前提条件**: 複数のノードが存在し、上ノードが選択されている
- **テストステップ**:
  1. 上部のノードを選択
  2. 下キーを押す
- **期待結果**: 次のノードが選択され、フォーカスが移動する

#### TC-UI-012: キーボードナビゲーション（上キー移動）
- **テスト名**: 上キーによる上ノードへの遷移確認
- **前提条件**: 複数のノードが存在し、下ノードが選択されている
- **テストステップ**:
  1. 下部のノードを選択
  2. 上キーを押す
- **期待結果**: 前のノードが選択され、フォーカスが移動する

#### TC-UI-013: キーボードナビゲーション（展開済みノードの右キー）
- **テスト名**: すでに展開済みノードでの右キー動作確認
- **前提条件**: すでに展開されている親ノードが選択されている
- **テストステップ**:
  1. 展開済みの親ノードを選択
  2. 右キーを押す
- **期待結果**: 何も変化せず、最初の子のノードが選択される

#### TC-UI-014: キーボードナビゲーション（子なしノードの右キー）
- **テスト名**: 子ノードを持たないノードでの右キー動作確認
- **前提条件**: 子ノードを持たないノードが選択されている
- **テストステップ**:
  1. 子なしノードを選択
  2. 右キーを押す
- **期待結果**: 何も変化しない

#### TC-UI-015: キーボードナビゲーション（最下ノードの下キー）
- **テスト名**: 最下ノードでの下キー動作確認
- **前提条件**: ツリーの最下ノードが選択されている
- **テストステップ**:
  1. 最下ノードを選択
  2. 下キーを押す
- **期待結果**: 何も変化しない、または最初のノードに戻る

#### TC-UI-016: キーボードナビゲーション（最上ノードの上キー）
- **テスト名**: 最上ノードでの上キー動作確認
- **前提条件**: ツリーの最上ノードが選択されている
- **テストステップ**:
  1. 最上ノードを選択
  2. 上キーを押す
- **期待結果**: 何も変化しない

### データベーステスト

#### TC-DB-001: マイグレーション適用
- **テスト名**: データベースマイグレーションの正常動作確認
- **前提条件**: マイグレーションファイルが存在する
- **テストステップ**:
  1. npm run db:migrate:local を実行
- **期待結果**: テーブルが作成され、エラーが発生しない

#### TC-DB-002: シードデータ投入
- **テスト名**: シードデータの正常投入確認
- **前提条件**: マイグレーションが完了している
- **テストステップ**:
  1. npm run db:seed を実行
- **期待結果**: サンプルデータが投入され、参照可能

#### TC-DB-003: データ整合性
- **テスト名**: 外部キー制約の確認
- **前提条件**: リレーションデータが存在する
- **テストステップ**:
  1. 親ノードを削除
- **期待結果**: 子ノードも連動して削除される、または制約エラーが発生

### 統合テスト

#### TC-INT-001: エンドツーエンドフロー
- **テスト名**: ノード作成から削除までの完全フロー
- **前提条件**: アプリケーションが起動している
- **テストステップ**:
  1. ブラウザでページを開く
  2. 新規ノードを作成
  3. ノードを編集
  4. 子ノードを追加
  5. 検索を実行
  6. ノードを削除
- **期待結果**: 全操作が正常に動作し、データが正しく保存/削除される

#### TC-INT-002: 同時アクセス
- **テスト名**: 複数ユーザー同時アクセスの動作確認
- **前提条件**: 複数のブラウザセッション
- **テストステップ**:
  1. 2つのブラウザで同時にノードを編集
- **期待結果**: 競合が発生せず、適切に処理される（現バージョンでは未実装）

## テスト環境

- **テストツール**: Postman (APIテスト)、ブラウザ (UIテスト)
- **テストデータ**: シードデータを使用
- **環境**: ローカル開発環境 (npm run dev:sandbox)

## 優先度

- 高: API基本機能、UI基本操作
- 中: 検索、ドラッグ&ドロップ
- 低: エラーハンドリング詳細、同時アクセス

## テスト完了基準

- 全テストケースの80%以上がPass
- クリティカルな機能（CRUD操作）は100% Pass
- UI操作がスムーズに動作