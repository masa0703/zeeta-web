# 画面定義書

このドキュメントは、Zeeta Web のユーザーインターフェース（UI）の詳細仕様を記載します。

## 画面一覧

| ID   | 画面名      | ファイル                   | 説明              |
| ---- | -------- | ---------------------- | --------------- |
| S010 | マイページ    | my-page.html           | ツリー一覧、通知、メンバー管理 |
| S020 | 招待受諾画面   | accept-invitation.html | 招待の確認と受諾        |
| S030 | ログイン画面   | login.html             | OAuth認証         |
| S040 | プロフィール画面 | profile.html           | ユーザー情報編集        |
| S100 | ツリーエディタ  | index.html             | ノード編集、ツリー操作     |

---

## S010: マイページ

### 概要
- **ファイル**: `public/my-page.html`, `public/static/my-page.js`
- **目的**: ユーザーがアクセス可能なツリーを一覧表示し、管理する

### レイアウト構造

```
┌─────────────────────────────────────────────────────────────┐
│ ヘッダー                                                     │
│ [ロゴ]              [通知ベル] [プロフィール] [ユーザー情報] [ログアウト] │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  マイツリー                            [+ 新しいツリーを作成] │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐        │
│  │ ツリーカード   │ │ ツリーカード   │ │ ツリーカード   │        │
│  │ [Owner]      │ │ [Owner]      │ │ [Owner]      │        │
│  └──────────────┘ └──────────────┘ └──────────────┘        │
│                                                              │
│  共有されたツリー                                             │
│  ┌──────────────┐ ┌──────────────┐                          │
│  │ ツリーカード   │ │ ツリーカード   │                          │
│  │ [Editor]     │ │ [Viewer]     │                          │
│  └──────────────┘ └──────────────┘                          │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### S010-01: ヘッダー

#### 構成要素

| 要素 | 説明 | スタイル |
|------|------|----------|
| ロゴ | "Zeeta Web" | グラデーションテキスト (#667eea → #764ba2) |
| 通知ベル | 未読通知数バッジ付き | `fas fa-bell`、赤バッジ |
| プロフィールリンク | プロフィール画面へ遷移 | `fas fa-user-cog` |
| ユーザー情報 | アバター、名前、メール | 丸いアバター画像 |
| ログアウト | セッション終了 | `fas fa-sign-out-alt` |

### S010-02: 注意書きバナー

**位置**: ヘッダー直下

```
┌─────────────────────────────────────────────────────────────┐
│ ⓘ これは、親を複数持てるツリー構造の有用性を試す目的で...     │
│   ・親を追加するには、ノード選択 → コピー → 親ノード選択...   │
└─────────────────────────────────────────────────────────────┘
```

**内容**:
- データプライバシーと継続性についての注意
- 親ノード追加の操作手順

**スタイル**:
- 背景: 黄色 (`bg-yellow-50`)
- ボーダー: 黄色 (`border-yellow-200`)
- アイコン: `fas fa-info-circle` (黄)

### S010-03: 通知ドロップダウン

**トリガー**: 通知ベルをクリック

**構成**:
- ヘッダー: "通知" + "すべて既読" ボタン
- 通知リスト: 最新順に表示
- 空の状態: "通知はありません"

**通知アイテム**:
```
┌─────────────────────────────────────────┐
│ [タイトル]                    [時刻]    │
│ [メッセージ]                            │
└─────────────────────────────────────────┘
```

**スタイル**:
- 未読: 背景 `#eef2ff` (淡い紫)
- 既読: 背景 白
- 幅: 400px
- 最大高さ: 500px (スクロール可)

### S010-04: ツリーカード

**構成**:
```
┌─────────────────────────────────────────┐
│ [ツリー名]                    [役割バッジ]│
│ [説明文]                                │
│                                         │
│ [更新日時]  [メンバー数]    [管理ボタン] │
└─────────────────────────────────────────┘
```

**役割バッジ**:
- Owner: グラデーション紫 (#667eea → #764ba2)
- Editor: 緑 (#48bb78)
- Viewer: 青 (#4299e1)

**動作**:
- カード本体クリック → ツリーエディタ (S100) に遷移
- 管理ボタン (Owner/Editor のみ) → メンバー管理モーダル

**ホバー効果**:
- `translateY(-4px)`
- シャドウ増加

### S010-05: ツリー作成モーダル

**トリガー**: "新しいツリーを作成" ボタン

**フォーム**:
| フィールド | タイプ | 必須 | 最大文字数 |
|-----------|--------|------|-----------|
| ツリー名 | text | ○ | 100 |
| 説明 | textarea | × | 500 |

**ボタン**:
- キャンセル: モーダルを閉じる
- 作成: API `POST /api/trees` を呼び出し

### S010-06: メンバー管理モーダル

**トリガー**: ツリーカードの管理ボタン

**構成**:
```
┌─────────────────────────────────────────┐
│ メンバー管理                        [×] │
├─────────────────────────────────────────┤
│ メールで招待 (Owner/Editor のみ)        │
│ [email入力] [役割選択▼] [招待ボタン]     │
├─────────────────────────────────────────┤
│ 招待中                                  │
│ ┌─────────────────────────────────────┐│
│ │ user@example.com  Editor 招待中 [×] ││
│ │ 期限: 2026/02/14                    ││
│ └─────────────────────────────────────┘│
├─────────────────────────────────────────┤
│ 現在のメンバー                          │
│ ┌─────────────────────────────────────┐│
│ │ [Avatar] 山田太郎    Owner          ││
│ └─────────────────────────────────────┘│
│ ┌─────────────────────────────────────┐│
│ │ [Avatar] 田中花子    Editor [▼][×]  ││
│ └─────────────────────────────────────┘│
└─────────────────────────────────────────┘
```

**招待取り消し**:
- [×] ボタンクリックで招待を取り消し
- API: `DELETE /api/trees/:id/invitations/:invitationId`
- 確認ダイアログ表示後に実行

**権限**:
- Owner: 招待送信、招待取り消し、役割変更、メンバー削除 可能
- Editor: 招待送信、招待取り消し 可能、役割変更・削除 不可
- Viewer: モーダル自体が表示されない

---

## S020: 招待受諾画面

### 概要
- **ファイル**: `public/accept-invitation.html`
- **目的**: メール招待リンクから遷移し、招待を確認・受諾する
- **URL**: `/accept-invitation.html?token={招待トークン}`

### レイアウト構造

```
┌─────────────────────────────────────────┐
│                                         │
│              [Zeeta ロゴ]               │
│                                         │
│         ┌───────────────────────┐       │
│         │  ツリーへの招待        │       │
│         │                       │       │
│         │  ツリー名: プロジェクトA │       │
│         │  招待者: 山田太郎       │       │
│         │  役割: 編集者          │       │
│         │  メール: user@test.com │       │
│         │  有効期限: 2026/02/13  │       │
│         │                       │       │
│         │  [招待を受け入れる] [キャンセル] │
│         └───────────────────────┘       │
│                                         │
└─────────────────────────────────────────┘
```

### S020-01: 状態遷移

```
[Loading] → [Content] → [Success]
              ↓
           [Error]
```

| 状態 | 説明 | 表示内容 |
|------|------|----------|
| Loading | 招待情報読み込み中 | スピナー |
| Content | 招待詳細表示 | 招待情報 + ボタン |
| Success | 受諾完了 | 成功メッセージ → 自動遷移 |
| Error | エラー発生 | エラーメッセージ + マイページリンク |

### S020-02: 招待詳細

**表示項目**:
| ラベル | 値 |
|--------|-----|
| ツリー名 | `tree_name` |
| 招待者 | `inviter_name` |
| あなたの役割 | 役割バッジ (Editor/Viewer) |
| 招待されたメールアドレス | `invitee_email` |
| 有効期限 | 日時フォーマット |

### S020-03: 認証チェック

**フロー**:
1. ページ読み込み時に `/auth/me` を呼び出し
2. 未認証の場合 → ログイン画面 (S030) にリダイレクト
   - `redirect` パラメータに現在のURLを設定
3. 認証済みの場合 → 招待情報を読み込み

---

## S030: ログイン画面

### 概要
- **ファイル**: `public/login.html`
- **目的**: OAuth認証 (Google/GitHub) でログイン
- **URL**: `/login.html` または `/login.html?redirect={遷移先URL}`

### レイアウト構造

```
┌─────────────────────────────────────────┐
│                                         │
│           ┌─────────────────┐           │
│           │   Zeeta Web     │           │
│           │  Collaborative  │           │
│           │  Outline Editor │           │
│           │                 │           │
│           │ [Google でログイン] │           │
│           │                 │           │
│           │ ログインすることで... │           │
│           └─────────────────┘           │
│                                         │
└─────────────────────────────────────────┘
```

### S030-01: OAuthボタン

| プロバイダー | アイコン | 色 |
|-------------|---------|-----|
| Google | `fab fa-google` | 青 (#4285f4) |

**備考**: GitHub ログインは非表示（バックエンドは残存）

**ホバー効果**:
- 背景色がアイコン色に変化
- テキストが白に変化
- `translateY(-2px)`

### S030-02: リダイレクト処理

**パラメータ**: `?redirect={URL}`

**フロー**:
1. URLから `redirect` パラメータを取得
2. OAuthボタンクリック時、`/auth/login/{provider}?redirect={URL}` に遷移
3. OAuth認証後、指定URLにリダイレクト
4. パラメータなしの場合はマイページ (S010) に遷移

### S030-03: 状態

| 状態 | 表示 |
|------|------|
| 通常 | ログインボタン |
| ローディング | スピナー + "認証中..." |
| エラー | エラーメッセージ (赤背景) |

---

## S040: プロフィール画面

### 概要
- **ファイル**: `public/profile.html`
- **目的**: ユーザーの表示名を編集する

### レイアウト構造

```
┌─────────────────────────────────────────────────────────────┐
│ ヘッダー                                                     │
│ [ロゴ]                        [マイページに戻る] [ログアウト] │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│              ┌─────────────────────────┐                     │
│              │   プロフィール設定        │                     │
│              │                         │                     │
│              │      [アバター画像]       │                     │
│              │                         │                     │
│              │  メールアドレス           │                     │
│              │  [user@example.com] (読取専用) │                │
│              │                         │                     │
│              │  表示名 *                │                     │
│              │  [山田 太郎           ]  │                     │
│              │                         │                     │
│              │  ログイン方法            │                     │
│              │  [Google アイコン] Google │                     │
│              │                         │                     │
│              │       [キャンセル] [保存] │                     │
│              └─────────────────────────┘                     │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### S040-01: フォームフィールド

| フィールド | タイプ | 編集可能 | バリデーション |
|-----------|--------|---------|---------------|
| メールアドレス | email | × | - |
| 表示名 | text | ○ | 必須、100文字以内 |
| ログイン方法 | 表示のみ | × | - |

### S040-02: アバター表示

**表示ロジック**:
1. `avatar_url` がある場合 → 画像を表示
2. ない場合 → グラデーション背景 + ユーザーアイコン

### S040-03: OAuthプロバイダー表示

| プロバイダー | アイコン | テキスト |
|-------------|---------|---------|
| google | `fab fa-google` (赤) | Google |
| github | `fab fa-github` (黒) | GitHub |
| test | `fas fa-flask` (青) | Test Account |

---

## S100: ツリーエディタ

### 概要
- **ファイル**: `public/index.html`, `public/static/app.js`
- **目的**: ノードの作成・編集・削除、ツリー構造の操作
- **URL**: `/index.html?tree={tree_id}`

### レイアウト構造

```
┌─────────────────────────────────────────────────────────────┐
│ ヘッダー                                                     │
│ [ロゴ]             [検索バー]            [version] [メンバー] │
├──────────────────────┬──────────────────────────────────────┤
│                      │                                      │
│  左ペイン             │  右ペイン                             │
│  (ツリー表示)         │  (ノード詳細)                         │
│                      │                                      │
│  [ルート追加] [逆ツリー] │  [親ノード表示]                       │
│                      │  [タイトル入力] (text-lg)              │
│  ├─ ノード1 [+]      │  [作成者選択] (ドロップダウン)           │
│  │  └─ 子1          │  [内容入力エリア]                      │
│  └─ ノード2 [+]      │  [保存] [削除] [子ノード追加]           │
│                      │                                      │
│  (高さ100%)           │  (高さ100%)                          │
└──────────────────────┴──────────────────────────────────────┘
```

### S100-01: ツリーヘッダー

**構成**: マイページリンク | ツリー名 | 役割バッジ | 再読み込みボタン

```
┌─────────────────────────────────────────────────────────────┐
│ ← マイページ | プロジェクトA [オーナー] [🔄]               │
└─────────────────────────────────────────────────────────────┘
```

| 要素 | 説明 | スタイル |
|------|------|----------|
| マイページリンク | `/my-page.html` へ遷移 | 左マージン 4px、紫色 (#667eea) |
| ツリー名 | 現在のツリー名 | font-bold、text-lg |
| 役割バッジ | Owner/Editor/Viewer | 丸いバッジ、色分け |
| 再読み込み | ツリーデータを再取得 | `fas fa-sync-alt` |

### S100-01b: アプリヘッダー

| 要素 | 説明 | スタイル |
|------|------|----------|
| ロゴ | "アウトラインエディタ" | emoji + bold |
| 検索バー | ノード検索 | 幅 384px、角丸 |
| バージョン | "build #XX" | 青バッジ |
| メンバー管理 | Owner/Editor のみ表示 | ボタン |

### S100-02: 左ペイン（ツリー表示）

#### ツールバー

| ボタン | アイコン | 動作 |
|--------|---------|------|
| ルートノード追加 | `fas fa-plus-circle` | プロンプトでタイトル入力→ノード作成 |
| 表示モード切替 | `fas fa-exchange-alt` | 通常/逆ツリー表示 |

#### ノード要素 (.tree-item)

```html
<div class="tree-item" data-node-id="{id}" data-node-path="{path}">
  <span class="expand-icon">▼</span>
  <span class="node-icon">📄</span>
  <span class="node-title">{タイトル}</span>
  <button class="add-child-btn">+</button>
</div>
```

**状態クラス**:
| クラス | 状態 | スタイル |
|--------|------|----------|
| `active` | 選択中 | 青背景 + 左ボーダー |
| `duplicate-active` | 複数親ノード選択 | 紫背景 + 左ボーダー |
| `ring-2 ring-yellow-300` | 検索ヒット | 黄色リング |

**階層インデント**: `padding-left: ${level * 20}px`

#### ドラッグ&ドロップ

- **ライブラリ**: SortableJS
- **ドラッグ中**: 半透明 + 青背景
- **ドロップ先**: 点線ボーダー

### S100-03: 右ペイン（ノード詳細）

#### レイアウト構造

```
┌─────────────────────────────────────────┐
│ [タイトル入力                ] [🗑️][💾] │  ← 固定ヘッダー
├─────────────────────────────────────────┤
│ ▶ 親ノード (2)                          │  ← アコーディオン
│ ┌─────────────────────────────────────┐│
│ │ 内容入力 (Markdown対応)              ││
│ │ リサイズ可能                         ││
│ └─────────────────────────────────────┘│
│ [作成者選択▼]                           │
│ 作成日: 2026/02/07  更新日: 2026/02/07  │
└─────────────────────────────────────────┘
```

#### 固定ヘッダー

**構成**: タイトル入力 + 削除ボタン + 保存ボタン

- タイトル入力は可能な限り幅を広げる (`flex-1`)
- ボタンはアイコンのみ（テキストなし）
- 保存ボタンのツールチップに "保存 (⌘+Enter)" を表示

#### 親ノード表示（アコーディオン）

**表示条件**: 非ルートノードの場合のみ

**動作**:
- デフォルトは折りたたまれた状態
- クリックで展開/折りたたみを切り替え
- アイコン（▶/▼）で状態を表示

```
┌─────────────────────────────────────────┐
│ 📊 親ノード (2)                     ▼   │  ← クリックで展開
│ ┌─────────────────────────────────────┐│
│ │ 親ノード1                    [×]    ││
│ └─────────────────────────────────────┘│
│ ┌─────────────────────────────────────┐│
│ │ 親ノード2                    [×]    ││
│ └─────────────────────────────────────┘│
└─────────────────────────────────────────┘
```

#### フォームフィールド

| フィールド | ID | スタイル | 備考 |
|-----------|-----|----------|------|
| タイトル | `#node-title` | `text-lg font-medium` | 固定ヘッダー内に配置 |
| 内容 | `#node-content` | EasyMDE | リサイズ可能、高さ200px〜600px |
| 作成者 | `#node-author` | select | 編集権限者のみリスト表示 |

**作成者ドロップダウン**:
- ツリーの Owner と Editor のみ選択肢に表示
- Viewer は表示されない
- 新規ノード作成時はログインユーザーがデフォルト選択

**内容エリア（EasyMDE）**:
- 最小高さ: 200px
- 最大高さ: 600px
- ユーザーがリサイズ可能
- 長いテキストは指定範囲内でスクロール

#### 操作ボタン

| ボタン | ID | スタイル | ショートカット |
|--------|-----|-----|--------------|
| 保存 | `#save-node-btn` | 青アイコンのみ | `Cmd/Ctrl + Enter` |
| 削除 | `#delete-node-btn` | 赤アイコンのみ | - |

**ツールチップ**: ボタンにホバーで動作説明を表示

#### 未選択状態

```
┌─────────────────────────────────────────┐
│                                         │
│     👆 左側のツリーからノードを選択してください │
│                                         │
└─────────────────────────────────────────┘
```

### S100-04: 権限ベースUI

| 要素 | Owner | Editor | Viewer |
|------|-------|--------|--------|
| ノード作成 | ○ | ○ | × |
| ノード編集 | ○ | ○ | × (読み取り専用) |
| ノード削除 | ○ | ○ | × |
| ドラッグ&ドロップ | ○ | ○ | × |
| メンバー管理ボタン | ○ | ○ | × |

### S100-05: 右クリックコンテキストメニュー

**トリガー**: ノードを右クリック

```
┌─────────────────────┐
│ 複製                │
├─────────────────────┤
│ コピー       ⌘C    │
│ ペースト     ⌘V    │
└─────────────────────┘
```

**メニュー項目**:

| 項目 | ショートカット | 動作 |
|------|---------------|------|
| 複製 | - | 現在パスの親ノード下に「Copy of {タイトル}」で複製 |
| コピー | `⌘C` / `Ctrl+C` | ノードをクリップボードにコピー |
| ペースト | `⌘V` / `Ctrl+V` | コピーしたノードを親子関係として追加 |

**複製の動作**:
1. 選択中のノードのデータを取得
2. 「Copy of {元のタイトル}」でノード新規作成
3. 元ノードと同じ親の下に配置（現在表示中のパスの親）
4. 複製ノードを自動選択

**スタイル**:
- 背景: 白
- ボーダー: グレー (`border-gray-200`)
- シャドウ: `shadow-lg`
- ホバー: 青背景 (`bg-blue-50`)
- ショートカット: グレーテキスト (`text-gray-400`)

### S100-06: 未保存変更の確認ダイアログ

**トリガー**: 編集中（未保存の変更あり）に他のノードを選択

```
┌─────────────────────────────────────────┐
│ 変更内容を保存しますか？                   │
│                                         │
│ 保存していない変更があります。              │
│                                         │
│        [いいえ]  [はい]                  │
└─────────────────────────────────────────┘
```

**動作**:
1. ノード編集中（タイトル・内容・作成者のいずれかが変更された状態）
2. 別のノードをクリック、または矢印キーでナビゲーション
3. 確認ダイアログを表示
   - **はい**: 変更を保存してから選択されたノードを表示
   - **いいえ**: 変更を破棄して選択されたノードを表示

**変更検知**:
- `originalNodeData` に読み込み時のデータを保持
- `hasUnsavedChanges()` で現在値と比較

**スタイル**:
- モーダル背景: 半透明黒
- ダイアログ: 白、角丸、シャドウ
- 「いいえ」ボタン: グレー
- 「はい」ボタン: 青（プライマリ）

### S100-07: ノードタイトル省略

**表示**:
- 長いタイトルは省略記号（`...`）で省略
- マウスオーバーでツールチップに全文表示

**実装**:
```css
.node-title {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
```

### S100-08: リロードボタン

**位置**: ツリー名+ロールバッジの右側

**アイコン**: `fas fa-sync-alt`

**動作**: クリックでツリーデータを再読み込み

---

## 共通UI要素

### ローディングオーバーレイ

```
┌─────────────────────────────────────────┐
│                                         │
│              [スピナー]                  │
│              処理中...                   │
│                                         │
└─────────────────────────────────────────┘
```

**スタイル**:
- 位置: fixed、全画面
- 背景: 半透明黒 (`rgba(0, 0, 0, 0.5)`)
- z-index: 1000

### トースト通知

**位置**: 画面右下 (fixed)

**種類**:
| タイプ | 背景色 | 用途 |
|--------|--------|------|
| success | 緑 (#10B981) | 操作成功 |
| error | 赤 (#EF4444) | エラー発生 |

**表示時間**: 5秒後に自動消去

### 確認ダイアログ

**使用箇所**:
- ノード削除
- 親子関係削除
- メンバー削除

**実装**: ブラウザネイティブ `confirm()`

---

## カラーパレット

### ブランドカラー

| 用途 | Tailwind | 色コード |
|------|----------|---------|
| プライマリ | グラデーション | #667eea → #764ba2 |
| セカンダリ | `bg-gray-50` | #F9FAFB |

### 状態色

| 状態 | Tailwind | 色コード |
|------|----------|---------|
| 成功 | `bg-green-500` | #10B981 |
| エラー | `bg-red-500` | #EF4444 |
| 警告 | `bg-yellow-500` | #F59E0B |
| 情報 | `bg-blue-500` | #3B82F6 |

### 役割色

| 役割 | 背景 | テキスト |
|------|------|---------|
| Owner | グラデーション紫 | 白 |
| Editor | #48bb78 | 白 |
| Viewer | #4299e1 | 白 |

---

## アイコン一覧

使用ライブラリ: **Font Awesome 6**

| アイコン | クラス | 用途 |
|---------|--------|------|
| ➕ | `fas fa-plus-circle` | ルートノード追加 |
| ➕ | `fas fa-plus` | 子ノード追加 |
| 💾 | `fas fa-save` | 保存 |
| 🗑️ | `fas fa-trash` | 削除 |
| 🔄 | `fas fa-exchange-alt` | 表示モード切替 |
| 🔔 | `fas fa-bell` | 通知 |
| 👤 | `fas fa-user` | ユーザー |
| ⚙️ | `fas fa-user-cog` | プロフィール設定 |
| 🚪 | `fas fa-sign-out-alt` | ログアウト |
| ← | `fas fa-arrow-left` | 戻る |
| ▼ | `fas fa-chevron-down` | 展開 |
| ▶ | `fas fa-chevron-right` | 折りたたみ |
| 📄 | `fas fa-file` | ルートノード |
| 📎 | `fas fa-paperclip` | 子ノード |
| 🕸️ | `fas fa-sitemap` | 親ノード表示 |
| ✖️ | `fas fa-times` | 閉じる/削除 |

---

## キーボードショートカット

| 画面 | キー | 動作 |
|------|------|------|
| S100 | `Cmd/Ctrl + C` | ノードをコピー |
| S100 | `Cmd/Ctrl + V` | ノードをペースト (親子関係追加) |
| S100 | `Cmd/Ctrl + Enter` | ノードを保存 |

---

## 今後の実装予定

（現在、主要な機能は実装済み）

---

## レスポンシブ対応

### 現在の実装
- デスクトップ専用設計
- 2カラムレイアウト固定

### 今後の対応予定
- タブレット: 左ペイン40%、右ペイン60%
- スマートフォン: タブ切り替え方式

---

## ブラウザ対応

### 対応ブラウザ
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

### 非対応
- Internet Explorer（全バージョン）
